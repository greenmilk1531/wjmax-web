name: WORKFLOW_FOR_DOCKER

on:
  push:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  # 1. ë¹Œë“œ ë¨¸ì‹  ì¤€ë¹„
  build:
    runs-on: ubuntu-latest

    steps:
      # 2. ë¹Œë“œ ë¨¸ì‹ ì— Repository Check Out
      - uses: actions/checkout@v3

      - name: Start Actions
        run: echo Start Actions!

      # 3. Docker Metaë¥¼ ì´ìš©í•˜ì—¬ ìƒì„±í•  ì´ë¯¸ì§€ì˜ ì´ë¦„ê³¼ ë²„ì „ ì •ë³´ íƒœê¹… 
      - name: Docker meta
        id: docker_meta
        uses: crazy-max/ghaction-docker-meta@v1
        with:
          images: iDaeun/daeun-portfolio-app
          tag-semver: |
            {{version}}
            {{major}}.{{minor}}

      # 4. ë¹Œë“œ ë¨¸ì‹ ì— Docker ë¹Œë“œì— í•„ìš”í•œ ì‚¬í•­ ì¤€ë¹„
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1
        
      # 5. ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ í•  ë‚´ ë„ì»¤í—ˆë¸Œ ë¡œê·¸ì¸
      - name: Login to DockerHub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
          
      # 6. ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œí•˜ê³  í—ˆë¸Œë¡œ í‘¸ì‰¬
      - name: Build and push
        uses: docker/build-push-action@v2
        with:
          context: .
          file: ./Dockerfile
          platforms: linux/amd64
          push: true
          tags: ${{ steps.docker_meta.outputs.tags }}
          labels: ${{ steps.docker_meta.outputs.labels }}

      - name: Finish Git Actions
        run: |
          echo Finished All Actions ğŸ¥³
          echo Please Check Your Docker Hub!
